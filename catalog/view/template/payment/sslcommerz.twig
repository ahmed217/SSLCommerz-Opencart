<div class="sslcommerz-payment">
  <p>{{ text_description }}</p>
  <form action="{{ confirm_action }}" method="post" id="form-sslcommerz-confirm">
    <button type="submit" class="btn btn-primary">{{ text_title }}</button>
  </form>
</div>

<script>
(function(){
  const form = document.getElementById('form-sslcommerz-confirm');
  if (!form) return;

  form.addEventListener('submit', function(e){
    e.preventDefault();

    const btn = form.querySelector('button');
    if (btn) {
      btn.disabled = true;
      btn.textContent = '{{ text_redirecting }}';
    }

    fetch(form.action, { method: 'POST' })
      .then(r => r.json())
      .then(json => {
        if (json && json.redirect) {
          window.location = json.redirect;
        } else {
          alert((json && json.error) ? json.error : 'Unable to start payment.');
          if (btn) { btn.disabled = false; btn.textContent = '{{ text_title }}'; }
        }
      })
      .catch(() => {
        alert('Network error. Please try again.');
        if (btn) { btn.disabled = false; btn.textContent = '{{ text_title }}'; }
      });
  });
})();
</script>
